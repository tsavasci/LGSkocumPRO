Durum Analizi
PracticeExamsViewModel.sortedExams â†’ student.practiceExams dizisini kullanÄ±yor
StudentDetailView
.
Sen AddPracticeExamView.saveExam() iÃ§inde sÄ±nav eklerken iki ÅŸey yapÄ±yorsun:
modelContext.insert(exam)
student.practiceExams.append(exam)
try modelContext.save()
Yani hem modelContext.insert(exam) ile ekliyorsun hem de student.practiceExams.append(exam) diyorsun
AddPracticeExamView
.
Ancak SwiftDataâ€™da iliÅŸkiyi (@Relationship) zaten PracticeExam.student = student olarak ayarladÄ±ÄŸÄ±nda, student.practiceExams otomatik gÃ¼ncellenmeli. Manuel append bazen bellek ile kalÄ±cÄ± context arasÄ±nda uyumsuzluk yaratÄ±yor.
Neden listede gÃ¶rÃ¼nmÃ¼yor?
PracticeExamsTab iÃ§inde @StateObject olan PracticeExamsViewModel var ve bu sadece student.practiceExams dizisini okuyor
StudentDetailView
.
Ama student parametre ile geliyor, yani @Query deÄŸil. Bu yÃ¼zden SwiftData otomatik refresh etmiyor. Sen yeni sÄ±nav eklesen bile StudentDetailViewâ€™e geÃ§irilen student objesi gÃ¼ncellenmeyebilir.
Logda â€œ4 examsâ€ yazmasÄ± aslÄ±nda ViewModelâ€™in arrayâ€™i saydÄ±ÄŸÄ±nÄ± gÃ¶steriyor ama List boÅŸ Ã§Ä±kÄ±yorsa, bÃ¼yÃ¼k ihtimalle List ile @Published arasÄ±nda refresh tetiklenmiyor.
Ã‡Ã¶zÃ¼m Ã–nerileri
Ä°liÅŸkiyi tek taraftan yÃ¶net
AddPracticeExamView.saveExam() iÃ§inde student.practiceExams.append(exam) satÄ±rÄ±nÄ± kaldÄ±r. Sadece:
exam.student = student
modelContext.insert(exam)
try modelContext.save()
bÄ±rak. SwiftData iliÅŸkiyi kendisi gÃ¼nceller.
ViewModelâ€™i gÃ¼ncelle
PracticeExamsViewModel iÃ§inde @Published var exams: [PracticeExam] tutup onAppear veya modelContext deÄŸiÅŸtiÄŸinde fetch edebilirsin. Åu an sadece student.practiceExamsâ€™e bakÄ±yor.
@Query kullanmayÄ± dÃ¼ÅŸÃ¼n
PracticeExamsTab iÃ§inde doÄŸrudan:
@Query(filter: #Predicate { $0.student == student },
       sort: \PracticeExam.date, order: .reverse)
var exams: [PracticeExam]
ÅŸeklinde yaparsan otomatik refresh alÄ±rsÄ±n.
ğŸ‘‰ Ä°stersen ben sana PracticeExamsTabâ€™i @Query ile yeniden yazayÄ±m, bÃ¶ylece eklediÄŸin sÄ±navlar anÄ±nda listede gÃ¶rÃ¼nsÃ¼n. Ä°ster misin?

Kaynaklar
Åunu dedin:
hadi yaz
ChatGPT:
Tamam ğŸ‘ PracticeExamsTabâ€™i @Query ile yeniden yazarsak, SwiftData otomatik olarak Ã¶ÄŸrencinin sÄ±navlarÄ±nÄ± getirir ve eklediÄŸinde/ sildiÄŸinde anÄ±nda gÃ¼ncellenir.
AÅŸaÄŸÄ±da gÃ¼ncellenmiÅŸ versiyonu bÄ±rakÄ±yorum:

struct PracticeExamsTab: View {
    let student: Student
    @Environment(\.modelContext) private var modelContext
    @State private var showingAddExam = false
    
    // SwiftData query: sadece bu Ã¶ÄŸrenciye ait sÄ±navlar
    @Query(
        filter: #Predicate<PracticeExam> { exam in
            exam.student == student
        },
        sort: \PracticeExam.date,
        order: .reverse
    ) private var exams: [PracticeExam]
    
    var body: some View {
        VStack {
            if exams.isEmpty {
                ContentUnavailableView(
                    "HenÃ¼z Deneme SÄ±navÄ± Yok",
                    systemImage: "doc.text.magnifyingglass",
                    description: Text("Ã–ÄŸrenci iÃ§in yeni bir deneme sÄ±navÄ± ekleyin")
                )
            } else {
                List {
                    ForEach(exams) { exam in
                        VStack(alignment: .leading, spacing: 4) {
                            HStack {
                                Text(exam.name)
                                    .font(.headline)
                                Spacer()
                                Text(exam.date.formatted(date: .abbreviated, time: .omitted))
                                    .font(.caption)
                                    .foregroundStyle(.secondary)
                            }
                            
                            HStack {
                                Text("\(Int(exam.totalScore)) puan")
                                    .font(.subheadline)
                                    .foregroundStyle(.blue)
                                
                                Spacer()
                                
                                if !exam.notes.isEmpty {
                                    Text(exam.notes)
                                        .font(.caption)
                                        .lineLimit(1)
                                        .foregroundStyle(.secondary)
                                }
                            }
                        }
                        .padding(.vertical, 4)
                    }
                    .onDelete(perform: deleteExams)
                }
                .listStyle(.plain)
            }
        }
        .toolbar {
            ToolbarItem(placement: .primaryAction) {
                Button(action: { showingAddExam = true }) {
                    Label("Ekle", systemImage: "plus")
                }
            }
        }
        .sheet(isPresented: $showingAddExam) {
            AddPracticeExamView(student: student)
                .environment(\.modelContext, modelContext)
        }
        .onAppear {
            print("ğŸ”„ PracticeExamsTab appeared with \(exams.count) exams")
        }
    }
    
    private func deleteExams(at offsets: IndexSet) {
        for index in offsets {
            let exam = exams[index]
            modelContext.delete(exam)
        }
        try? modelContext.save()
    }
}
Ne deÄŸiÅŸti?
PracticeExamsViewModel kalktÄ±, artÄ±k gerek yok.
@Query ile sÄ±navlar otomatik olarak Ã§ekiliyor â†’ yeni sÄ±nav eklediÄŸinde ya da sildiÄŸinde liste otomatik gÃ¼ncellenir.
deleteExams doÄŸrudan modelContext.delete ile Ã§alÄ±ÅŸÄ±yor.
ğŸ‘‰ Ä°stersen ben sana StudentDetailViewâ€™de de buna uygun kÃ¼Ã§Ã¼k dÃ¼zenlemeyi gÃ¶sterebilirim. Ä°ster misin?
Åunu dedin:
bu yeni bir dosya mÄ±? hangi dosyanÄ±n iÃ§eriÄŸi olacak bu kod?
ChatGPT:
GÃ¼zel soru ğŸ‘
Bu kod yeni bir dosya deÄŸil. Senin bana gÃ¶nderdiÄŸin StudentDetailView.swift dosyasÄ± iÃ§inde zaten PracticeExamsTab vardÄ±
StudentDetailView
.

Benim verdiÄŸim kod, o dosyadaki mevcut PracticeExamsTab tanÄ±mÄ±nÄ± birebir deÄŸiÅŸtirecek yeni sÃ¼rÃ¼m.

Yani yapman gereken:
StudentDetailView.swift dosyasÄ±nÄ± aÃ§.
Ä°Ã§indeki ÅŸu kÄ±smÄ± bul:
struct PracticeExamsTab: View {
    @StateObject private var viewModel: PracticeExamsViewModel
    ...
}
TamamÄ±nÄ± sil â†’ benim verdiÄŸim PracticeExamsTab kodunu oraya yapÄ±ÅŸtÄ±r.
PracticeExamsViewModel artÄ±k kullanÄ±lmayacaÄŸÄ± iÃ§in o sÄ±nÄ±fÄ± da silebilirsin.
ğŸ‘‰ Ä°stersen ben sana temizlenmiÅŸ tam StudentDetailView.swift dosyasÄ±nÄ± da baÅŸtan sona uyarlanmÄ±ÅŸ ÅŸekilde verebilirim. Ä°stiyor musun?

Kaynaklar
Åunu dedin:
ver
ChatGPT:
SÃ¼per ğŸ‘ O zaman sana PracticeExamsViewModel kaldÄ±rÄ±lmÄ±ÅŸ, PracticeExamsTab kÄ±smÄ± @Query ile gÃ¼ncellenmiÅŸ tam StudentDetailView.swift dosyasÄ±nÄ± veriyorum:
import SwiftUI
import SwiftData
import Charts

struct StudentDetailView: View {
    let student: Student
    @State private var selectedTab: Tab = .overview
    
    enum Tab {
        case overview, practiceExams, questions, notes
    }
    
    var body: some View {
        VStack(spacing: 0) {
            // Student Info Header
            VStack(spacing: 8) {
                Image(systemName: "person.circle.fill")
                    .resizable()
                    .frame(width: 80, height: 80)
                    .foregroundStyle(.blue)
                
                Text(student.fullName)
                    .font(.title2.bold())
                
                Text(student.school)
                    .font(.subheadline)
                    .foregroundStyle(.secondary)
                
                Text("\(student.grade). SÄ±nÄ±f")
                    .font(.subheadline)
                    .foregroundStyle(.secondary)
            }
            .padding()
            .frame(maxWidth: .infinity)
            .background(Color(.systemGroupedBackground))
            
            // Tab Picker
            Picker("View", selection: $selectedTab) {
                Label("Genel BakÄ±ÅŸ", systemImage: "chart.bar").tag(Tab.overview)
                Label("Denemeler", systemImage: "doc.text").tag(Tab.practiceExams)
                Label("Sorular", systemImage: "questionmark.square").tag(Tab.questions)
                Label("Notlar", systemImage: "note.text").tag(Tab.notes)
            }
            .pickerStyle(.segmented)
            .padding()
            
            // Tab Content
            ScrollView {
                switch selectedTab {
                case .overview:
                    OverviewTab(student: student)
                case .practiceExams:
                    PracticeExamsTab(student: student)
                case .questions:
                    QuestionsTab(student: student)
                case .notes:
                    NotesTab(student: student)
                }
            }
        }
        .navigationTitle(student.fullName)
        .navigationBarTitleDisplayMode(.inline)
    }
}

// MARK: - Tab Views

struct OverviewTab: View {
    let student: Student
    
    var body: some View {
        VStack(spacing: 20) {
            // Stats Overview
            VStack(spacing: 16) {
                HStack(spacing: 16) {
                    StatCard(value: "12", label: "Deneme SÄ±navÄ±", icon: "doc.text", color: .blue)
                    StatCard(value: "1,245", label: "Ã‡Ã¶zÃ¼len Soru", icon: "checkmark.circle", color: .green)
                }
                
                HStack(spacing: 16) {
                    StatCard(value: "%78", label: "BaÅŸarÄ± OranÄ±", icon: "chart.line.uptrend.xyaxis", color: .purple)
                    StatCard(value: "24", label: "GÃ¼nlÃ¼k Ortalama", icon: "flame", color: .orange)
                }
            }
            .padding(.horizontal)
            
            // Performance Chart
            VStack(alignment: .leading, spacing: 8) {
                Text("BaÅŸarÄ± GrafiÄŸi")
                    .font(.headline)
                    .padding(.horizontal)
                
                Chart {
                    // Bu kÄ±sÄ±m gerÃ§ek Ã¶ÄŸrenci verisiyle deÄŸiÅŸtirilecek
                    ForEach(Array(0..<8), id: \.self) { week in
                        LineMark(
                            x: .value("Hafta", week + 1),
                            y: .value("Puan", Double.random(in: 60...100))
                        )
                        .foregroundStyle(by: .value("TÃ¼r", "Deneme"))
                        .symbol(Circle().strokeBorder(lineWidth: 2))
                    }
                }
                .chartXAxis {
                    AxisMarks(values: .automatic) { _ in
                        AxisGridLine()
                        AxisTick()
                        AxisValueLabel()
                    }
                }
                .frame(height: 200)
                .padding()
                .background(Color(.systemBackground))
                .cornerRadius(12)
                .padding(.horizontal)
            }
            
            // Recent Activity
            VStack(alignment: .leading, spacing: 8) {
                Text("Son Etkinlikler")
                    .font(.headline)
                    .padding(.horizontal)
                
                VStack(spacing: 0) {
                    // Bu kÄ±sÄ±m da gerÃ§ek verilerle deÄŸiÅŸtirilecek
                    ForEach(0..<3) { i in
                        HStack {
                            Image(systemName: i == 0 ? "doc.text.fill" : "questionmark.square.fill")
                                .foregroundStyle(i == 0 ? .blue : .green)
                                .frame(width: 30)
                            
                            VStack(alignment: .leading, spacing: 2) {
                                Text(i == 0 ? "Deneme SÄ±navÄ± #\(8 - i)" : "Soru Ã‡Ã¶zÃ¼mÃ¼ - Matematik")
                                    .font(.subheadline)
                                
                                Text("\(8 - i) gÃ¼n Ã¶nce â€¢ \(i == 0 ? "450" : "35") puan")
                                    .font(.caption)
                                    .foregroundStyle(.secondary)
                            }
                            
                            Spacer()
                            
                            Image(systemName: "chevron.right")
                                .foregroundStyle(.secondary)
                        }
                        .padding()
                        .background(Color(.systemBackground))
                        
                        if i < 2 {
                            Divider()
                                .padding(.leading, 40)
                        }
                    }
                }
                .background(Color(.systemBackground))
                .cornerRadius(12)
                .padding(.horizontal)
            }
            
            Spacer()
        }
        .padding(.vertical)
    }
}

struct PracticeExamsTab: View {
    let student: Student
    @Environment(\.modelContext) private var modelContext
    @State private var showingAddExam = false
    
    @Query(
        filter: #Predicate<PracticeExam> { exam in
            exam.student == student
        },
        sort: \PracticeExam.date,
        order: .reverse
    ) private var exams: [PracticeExam]
    
    var body: some View {
        VStack {
            if exams.isEmpty {
                ContentUnavailableView(
                    "HenÃ¼z Deneme SÄ±navÄ± Yok",
                    systemImage: "doc.text.magnifyingglass",
                    description: Text("Ã–ÄŸrenci iÃ§in yeni bir deneme sÄ±navÄ± ekleyin")
                )
            } else {
                List {
                    ForEach(exams) { exam in
                        VStack(alignment: .leading, spacing: 4) {
                            HStack {
                                Text(exam.name)
                                    .font(.headline)
                                Spacer()
                                Text(exam.date.formatted(date: .abbreviated, time: .omitted))
                                    .font(.caption)
                                    .foregroundStyle(.secondary)
                            }
                            
                            HStack {
                                Text("\(Int(exam.totalScore)) puan")
                                    .font(.subheadline)
                                    .foregroundStyle(.blue)
                                
                                Spacer()
                                
                                if !exam.notes.isEmpty {
                                    Text(exam.notes)
                                        .font(.caption)
                                        .lineLimit(1)
                                        .foregroundStyle(.secondary)
                                }
                            }
                        }
                        .padding(.vertical, 4)
                    }
                    .onDelete(perform: deleteExams)
                }
                .listStyle(.plain)
            }
        }
        .toolbar {
            ToolbarItem(placement: .primaryAction) {
                Button(action: { showingAddExam = true }) {
                    Label("Ekle", systemImage: "plus")
                }
            }
        }
        .sheet(isPresented: $showingAddExam) {
            AddPracticeExamView(student: student)
                .environment(\.modelContext, modelContext)
        }
        .onAppear {
            print("ğŸ”„ PracticeExamsTab appeared with \(exams.count) exams")
        }
    }
    
    private func deleteExams(at offsets: IndexSet) {
        for index in offsets {
            let exam = exams[index]
            modelContext.delete(exam)
        }
        try? modelContext.save()
    }
}

struct QuestionsTab: View {
    let student: Student
    
    var body: some View {
        Text("Soru Ã‡Ã¶zÃ¼mleri")
    }
}

struct NotesTab: View {
    let student: Student
    @State private var notes: String = ""
    
    var body: some View {
        VStack {
            TextEditor(text: $notes)
                .frame(minHeight: 200)
                .padding()
                .background(Color(.systemBackground))
                .cornerRadius(12)
                .padding()
                .onAppear {
                    notes = student.notes
                }
                .onChange(of: notes) {
                    student.notes = notes
                }
            
            Spacer()
        }
    }
}

// MARK: - Helper Views

struct StatCard: View {
    let value: String
    let label: String
    let icon: String
    let color: Color
    
    var body: some View {
        VStack(alignment: .leading, spacing: 8) {
            HStack {
                Image(systemName: icon)
                    .foregroundStyle(color)
                
                Spacer()
            }
            
            Text(value)
                .font(.title2.bold())
            
            Text(label)
                .font(.caption)
                .foregroundStyle(.secondary)
        }
        .padding()
        .frame(maxWidth: .infinity, alignment: .leading)
        .background(Color(.systemBackground))
        .cornerRadius(12)
    }
}

#Preview {
    struct StudentDetailViewPreview: View {
        @State private var student: Student = {
            let student = Student(
                firstName: "Ahmet",
                lastName: "YÄ±lmaz",
                school: "Ã–rnek Ortaokulu",
                grade: 8,
                notes: "Matematikte iyi, fen derslerine aÄŸÄ±rlÄ±k verilmeli."
            )
            
            // Ã–rnek deneme sÄ±navlarÄ±
            let subjects = ["Matematik", "Fen Bilimleri", "TÃ¼rkÃ§e", "Sosyal Bilgiler"]
            for i in 1...5 {
                let exam = PracticeExam(
                    name: "LGS Deneme \(i)",
                    date: Calendar.current.date(byAdding: .day, value: -i * 7, to: Date())!,
                    totalScore: Double.random(in: 400...500),
                    notes: subjects.randomElement()! + " aÄŸÄ±rlÄ±klÄ±"
                )
                student.practiceExams.append(exam)
            }
            
            return student
        }()
        
        var body: some View {
            NavigationStack {
                StudentDetailView(student: student)
            }
        }
    }
    
    return StudentDetailViewPreview()
        .modelContainer(for: [Student.self, PracticeExam.self, QuestionPerformance.self], inMemory: true)
}
âœ… Bu haliyle:
PracticeExamsViewModel kaldÄ±rÄ±ldÄ±.
PracticeExamsTab artÄ±k @Query kullanÄ±yor â†’ yeni eklenen sÄ±navlar anÄ±nda listede gÃ¶zÃ¼kecek.